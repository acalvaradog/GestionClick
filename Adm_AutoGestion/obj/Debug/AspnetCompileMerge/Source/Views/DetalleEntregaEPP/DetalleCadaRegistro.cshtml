@model IEnumerable<Adm_AutoGestion.Models.DetalleEntregaEPP>
@using System.Web.UI.WebControls;


@{
    ViewBag.Title = "DetalleCadaRegistro";
    Layout = "~/Views/Shared/_LayoutMaestra.cshtml";
}

<h2 class="colorTitulo text-center mt-3">Informe Entregas</h2>

<form>
    <div class="card">
        <div class="card-header text-white fondoDegradado mb-3">Buscar</div>
        <div class="card-body">
            <div class="row justify-content-start">
                <div class="col-4" style="text-align:left">
                    <label for="sospechoso">Empleado Crea Acta:</label>
                    @*@Html.TextBox("EmpleadoCA",null,  htmlAttributes: new { @class = "form-control" } )*@
                    @Html.DropDownList("EmpleadoCA", new SelectList(ViewBag.Empleado, "Nombres", "Nombres"), "Seleccione...", htmlAttributes: new { @class = "form-control selectpicker", data_live_search = "true" })
                </div>
                <div class="col-4" style="text-align:left">
                    <label for="sospechoso">Empleado Recibe EPP:</label>
                    @*@Html.TextBox("EmpleadoRE",null,  htmlAttributes: new { @class = "form-control" } )*@
                    @Html.DropDownList("EmpleadoRE", new SelectList(ViewBag.Empleado, "Nombres", "Nombres"), "Seleccione...", htmlAttributes: new { @class = "form-control selectpicker", data_live_search = "true" })
                </div>
                <div class="col-4" style="text-align:left">
                    <label for="sospechoso">Area Entrega:</label>
                    @*@Html.TextBox("AreaEntrega",null,  htmlAttributes: new { @class = "form-control" } )*@
                    @Html.DropDownList("AreaEntrega", (List<SelectListItem>)ViewBag.Areas, "Seleccione el Area", htmlAttributes: new { @class = "form-control selectpicker", data_live_search = "true" })
                </div>
            </div>
            <br />
            <div class="row justify-content-start">
                <div class="col-3" style="text-align:left">
                    <label for="sospechoso">Fecha Acta Desde:</label>
                    @Html.TextBox("FechaActaD", "{0:d}", htmlAttributes: new { @class = "form-control", type = "date" })
                </div>
                <div class="col-3" style="text-align:left">
                    <label for="sospechoso">Fecha Acta Hasta:</label>
                    @Html.TextBox("FechaActaH", "{0:d}", htmlAttributes: new { @class = "form-control", type = "date" })
                </div>

                <div class="col-3" style="text-align:left">
                    <label for="sospechoso">Fecha Entrega Desde:</label>
                    @Html.TextBox("FechaEntregaD", "{0:d}", htmlAttributes: new { @class = "form-control", type = "date" })
                </div>
                <div class="col-3" style="text-align:left">
                    <label for="sospechoso">Fecha Entrega Hasta:</label>
                    @Html.TextBox("FechaEntregaH", "{0:d}", htmlAttributes: new { @class = "form-control", type = "date" })
                </div>
            </div>
            <br />
            <div class="row justify-content-start">
                <div class="col-3" style="text-align:left">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="Anulados" name="Anulados" />
                        Mostrar Anulados
                    </div>
                </div>
            </div>

            <div class="row justify-content-start">
                <div class="col-12" style="text-align:center">
                    <button type="submit" id="Search" class="bi bi-search btn btn-outline-primary mb-2" onclick="@Url.Action("DetalleCadaRegistro","DetalleEntregaEPP")"> Buscar</button>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-hover display dataTable table-sm" id="Exportar_a_Excel">
        <thead>
            <tr class="fondoDegradado align-middle text-white">
                <th>
                    Numero Entrega
                </th>
                <th>
                    Fecha Acta
                </th>
                <th>
                    Cedula
                </th>
                <th>
                    Empleado Crea Acta
                </th>
                <th>
                    Area
                </th>
                <th>
                    Sociedad
                </th>
                <th>
                    Estado Acta
                </th>
                <th>
                    EPP
                </th>
                <th>
                    Documento
                </th>
                <th>
                    Empleado Recibe EPP
                </th>
                <th>
                    Empresa
                </th>
                <th>
                    Cargo
                </th>
                <th>
                    Area
                </th>
                <th>
                    Género
                </th>
                <th>
                    Fecha de Ingreso
                </th>
                <th>
                    Cantidad
                </th>
                <th>
                    Motivo Entrega
                </th>
                <th>
                    Fecha Recibe
                </th>
                <th>
                    Fecha Firma
                </th>
                <th>
                    Fecha Vencimiento
                </th>
                <th>
                    Observacion
                </th>
                <th>
                    Estado
                </th>
                <th>Anular Registro</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.NumeroEntrega)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.EntregaEPP.Fecha)*@
                        @Convert.ToDateTime(item.EntregaEPP.Fecha).ToString("dd/MM/yyyy")
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EntregaEPP.Empleado.Documento)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EntregaEPP.Empleado.Nombres)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EntregaEPP.Area)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Sociedades.Descripcion)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EntregaEPP.Estado)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ElementosProtecionPersonal.Nombre)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Empleado.Documento)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Empleado.Nombres)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EmpleadoSoc.Descripcion)
                    </td>
                    <td>
                        @if (item.Cargo == "" || item.Cargo == null)
                        {
                            @Html.DisplayFor(modelItem => item.Empleado.Cargo)
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.Cargo)
                        }
                    </td>
                    <td>
                        @if (item.Area == "" || item.Area == null)
                        {
                            @Html.DisplayFor(modelItem => item.Empleado.Area)
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.Area)
                        }
                    </td>
                    <td>
                        @if (item.Empleado.Genero == "1")
                        {
                            <p>Masculino</p>
                        }
                        else
                        {
                            <p>Femenino</p>
                        }

                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.Empleado.FechaIngreso)*@
                        @Convert.ToDateTime(item.Empleado.FechaIngreso).ToString("dd/MM/yyyy")
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Cantidad)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MotivoEntrega)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.Fecha)*@
                        @Convert.ToDateTime(item.Fecha).ToString("dd/MM/yyyy")
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FechaFirma)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.FechaFin)*@
                        @Convert.ToDateTime(item.FechaFin).ToString("dd/MM/yyyy")
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Observacion)
                    </td>
                    <td>
                        @if (item.Estado == "Anulado")
                        {
                            <div style="color:#FF0000;">
                                @Html.DisplayFor(modelItem => item.Estado)
                            </div>
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.Estado)
                        }
                    </td>
                    <td>
                        <a href="javascript:AnularRegistro1('@Html.DisplayFor(modelItem => item.Id)');" style="color:#FF0000;">
                            <img src="~/Contents/image/anular.png" alt="AnularRegistro" />
                        </a>
                    </td>
                </tr>
            }

        </tbody>
    </table>
</div>


<div class="modal fade" id="processState" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">&nbsp;Mensaje</h5>
            </div>
            <div class="modal-body">
                <input class="form-control border-0" id="mensaje" name="mensaje">
            </div>
            <div class="modal-footer">
                <button id="signatureSbmt" type="submit" class="btn btn-primary" onclick="return reloadPage();">Aceptar</button>
            </div>
        </div>
    </div>
</div>



<script>

    function AnularRegistro1(id) {

        alertify.confirm("Esta Seguro que Desea anular el registro?", function (e) {
            if (e) {

                AnularRegistro(id);
            } else {

            }
        });
    }

    function AnularRegistro(id) {



        try {
            $.ajax({
                url: '@Url.Action("AnularRegistro", "DetalleEntregaEPP")',
                data: { 'id': id },
                type: "post",
                success: function (e) {

                    $("#mensaje").val(e);
                    $("#processState").modal("show");



                },
                error: function (xhr, status, error) { alert(error); }
            });

        }
        catch (e) { alert(e); }
    }

    function reloadPage() {
        location.reload();
    }


    $(document).ready(function () {
        var table = $('#Exportar_a_Excel').DataTable({
            language: {
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "Ningún dato disponible en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero-",
                    "sLast": "Último",
                    "sNext": "  - Siguiente",
                    "sPrevious": "Anterior -  "
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                }
            },

            "pagingType": "simple",
            dom: 'Brtip',

            buttons: [
			{

			    extend: 'excelHtml5',
                text: '<i class="fas fa-file-excel"></i>',
                filename: 'InformeEntregaEPP',
                titleAttr: 'Exportar a Excel',
                className: 'btn btn-success'
			}
            ]
        });



    });

</script>